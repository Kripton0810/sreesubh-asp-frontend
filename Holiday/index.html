<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <title>Sreesubh</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .title {
        width: 100%;
        display: flex;
        flex-direction: row;
        align-items: center;
      }

      @font-face {
        font-family: dolphin;
        src: url(../Dolphin.ttf);
      }
    </style>
  </head>
  <body onload="getHolidayData()">
    <header>
      <nav class="navbar navbar-light bg-light d-flex flex-row">
        <div class="container-fluid">
          <div class="title">
            <div
              type="button"
              data-bs-toggle="offcanvas"
              data-bs-target="#offcanvasBottom"
              aria-controls="offcanvasBottom"
            >
              <i class="fas fa-bars p-2"></i>
            </div>
            <a
              class="navbar-brand px-3 mx-4"
              href="/"
              style="
                font-family: dolphin;
                font-size: 2rem;
                color: rgb(201, 201, 0);
              "
              >Sreesubh</a
            >
          </div>
        </div>
      </nav>
    </header>

    <div
      class="offcanvas offcanvas-start"
      tabindex="-1"
      id="offcanvasBottom"
      aria-labelledby="offcanvasBottomLabel"
    >
      <div class="offcanvas-header">
        Sreesubh
        <button
          type="button"
          class="btn-close text-reset"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body small">
        <div class="list-group">
          <a
            href="../"
            class="list-group-item list-group-item-action"
            aria-current="true"
          >
            <i class="fas fa-home"></i> Home
          </a>
          <a
            href="../attendance/"
            class="list-group-item list-group-item-action"
            ><i class="fa fa-user-circle" aria-hidden="true"></i> Attendance</a
          >
          <a
            href="../Holiday/"
            class="list-group-item list-group-item-action active"
            ><i class="fas fa-cloud-sun"></i> Holiday</a
          >
          <a
            href="../Leavemanagement/"
            class="list-group-item list-group-item-action"
            ><i class="fa fa-user-circle" aria-hidden="true"></i> Leave
            request</a
          >
          <a
            href="../Report/"
            class="list-group-item list-group-item-action"
            tabindex="-1"
            aria-disabled="true"
            ><i class="fa fa-sticky-note" aria-hidden="true"></i> Get Attendance
            Report</a
          >
        </div>
      </div>
    </div>
    <div class="root">
      <nav>
        <div
          class="nav nav-tabs justify-content-center"
          id="nav-tab"
          role="tablist"
        >
          <button
            class="nav-link active"
            id="nav-home-tab"
            data-bs-toggle="tab"
            data-bs-target="#nav-home"
            type="button"
            role="tab"
            aria-controls="nav-home"
            aria-selected="true"
          >
            Holiday List
          </button>
          <button
            class="nav-link"
            id="nav-profile-tab"
            data-bs-toggle="tab"
            data-bs-target="#nav-profile"
            type="button"
            role="tab"
            aria-controls="nav-profile"
            aria-selected="false"
          >
            Add Holiday
          </button>
        </div>
      </nav>
      <div class="tab-content" id="nav-tabContent">
        <div
          class="tab-pane fade show active"
          id="nav-home"
          role="tabpanel"
          aria-labelledby="nav-home-tab"
        >
          <table
            class="table table-dark table-hover mt-2 mx-auto"
            style="width: 95%"
          >
            <thead>
              <tr>
                <th>Id</th>
                <th>Holiday Name</th>
                <th>Holiday Date</th>
                <th>Change/Delete</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div
          class="tab-pane fade"
          id="nav-profile"
          role="tabpanel"
          aria-labelledby="nav-profile-tab"
        >
          <div
            id="add_row"
            class="row container-fluid justify-content-center my-3"
          >
            <button class="btn btn-info col-2" onclick="addrow()">
              <i class="fa fa-plus-circle" aria-hidden="true"></i>
              Add Holiday
            </button>
            <div class="row justify-content-center mt-3">
              <div class="col-3 h5 text-center">Holiday Name</div>
              <div class="col-3 h5 text-center">Holiday Date</div>
              <div class="col-1"></div>
            </div>
            <div id="root-add">
              <div class="row justify-content-center mt-3">
                <div class="col-3">
                  <input type="text" class="form-control" required="" />
                </div>
                <div class="col-3">
                  <input type="date" class="form-control" required="" />
                </div>
                <div class="col-1">
                  <div class="btn btn-danger" onclick="removeme(this)">
                    <i class="fa fa-trash" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
            <button class="btn btn-success col-2 mt-3" onclick="submit()">
              <i class="fa fa-leaf" aria-hidden="true"></i>
              Submit
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="toast" style="position: fixed; top: 20%; left: 2%">
      <div class="toast-header">
        <strong class="me-auto">Notification</strong>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="toast"
        ></button>
      </div>
      <div class="toast-body">
        <p class="noti-message">Some text inside the toast body</p>
      </div>
    </div>
    <!-- Button trigger modal -->

    <!-- Modal -->
    <div
      class="modal fade"
      id="exampleModal"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">
              <i class="fas fa-edit"></i>
              Edit
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="input-group mb-3">
              <span class="input-group-text" id="basic-addon1">
                <i class="fa fa-id-badge" aria-hidden="true"></i>
              </span>
              <input
                type="text"
                class="form-control"
                placeholder="Holiday Id"
                aria-label="Username"
                aria-describedby="basic-addon1"
                disabled
                id="edit_id"
              />
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text" id="basic-addon1">
                <i class="fa fa-calendar" aria-hidden="true"></i>
              </span>
              <input
                type="text"
                class="form-control"
                placeholder="Holiday name"
                aria-label="Username"
                aria-describedby="basic-addon1"
                id="edit_name"
              />
            </div>
            <div class="input-group mb-3">
              <span class="input-group-text" id="basic-addon1">
                <i class="fa fa-calendar" aria-hidden="true"></i>
              </span>
              <input
                type="date"
                class="form-control"
                placeholder="Holiday name"
                aria-label="Username"
                aria-describedby="basic-addon1"
                id="edit_date"
              />
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Close
            </button>
            <button
              type="button"
              class="btn btn-primary"
              data-bs-dismiss="modal"
              onclick="holidayUpdate()"
            >
              Save changes
            </button>
          </div>
        </div>
      </div>
    </div>
    <script src="https://momentjs.com/downloads/moment.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.4/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script>
      function toastCall(msg) {
        var toastElList = [].slice.call(document.querySelectorAll(".toast"));
        var toastList = toastElList.map(function (toastEl) {
          return new bootstrap.Toast(toastEl);
        });
        document.querySelector(".noti-message").innerHTML = msg;
        toastList.forEach((toast) => toast.show());
      }
      function submit() {
        const rows = document.getElementById("root-add");
        var childerns = rows.children;
        for (let index = 0; index < childerns.length; index++) {
          var holiday_name =
            childerns[index].children[0].getElementsByTagName("input")[0].value;
          var holiday_date =
            childerns[index].children[1].getElementsByTagName("input")[0].value;
          var settings = {
            url: "http://app.sreesubh.in/api/Holiday/setHoliday",
            method: "POST",
            dataType: "json",
            data: {
              holidayName: holiday_name,
              holidayDate: holiday_date,
            },
          };
          $.ajax(settings).done(function (response) {
            toastCall(response.msg);
            removeme(childerns[index].children[0]);
          });
        }
      }
      function holidayUpdate() {
        var settings = {
          url: "http://app.sreesubh.in/api/Holiday/editHoliday",
          method: "POST",
          dataType: "json",
          data: {
            Id: document.getElementById("edit_id").value,
            holidayDate: document.getElementById("edit_date").value,
            holidayName: document.getElementById("edit_name").value,
          },
        };
        console.log(settings);
        $.ajax(settings)
          .done(function (response) {
            Swal.fire("Updated", "", "info");
            getHolidayData();
          })
          .fail((resp) => {
            console.log(resp);
          });
      }
      function removeme(data) {
        var x = data.parentElement.parentElement.parentElement;
        var y = data.parentElement.parentElement;
        x.removeChild(y);
      }
      function setdata(data) {
        var x = data.parentElement.parentElement.parentElement;
        console.log(x.getElementsByTagName("td")[0].innerText);
        console.log(x.getElementsByTagName("td")[1].innerText);
        console.log(x.getElementsByTagName("td")[2].innerText);
        $("#edit_id").val(x.getElementsByTagName("td")[0].innerText);
        $("#edit_name").val(x.getElementsByTagName("td")[1].innerText);
        // $("#edit_date")
        var date = x
          .getElementsByTagName("td")[2]
          .innerText.split("-")
          .reverse()
          .join("-");
        document.getElementById("edit_date").valueAsDate = new Date(date);
      }
      function addrow() {
        var row = document.querySelector("#root-add");
        var inputbox = document.createElement("input");
        inputbox.setAttribute("type", "text");
        inputbox.classList.add("form-control");
        inputbox.setAttribute("required", "");

        var datebox = document.createElement("input");
        datebox.setAttribute("type", "date");
        datebox.classList.add("form-control");
        datebox.setAttribute("required", "");
        var i = document.createElement("i");
        i.classList.add("fa", "fa-trash");
        i.setAttribute("aria-hidden", "true");
        //make remove button
        var remove_btn = document.createElement("button");
        remove_btn.classList.add("btn", "btn-danger");
        remove_btn.setAttribute("onclick", "removeme(this)");
        // onclick="removeme(this)"
        ////
        remove_btn.append(i);
        var col_3_1 = document.createElement("div");
        var col_3_2 = document.createElement("div");
        var col_3_3 = document.createElement("div");
        col_3_1.classList.add("col-3");
        col_3_2.classList.add("col-3");
        col_3_3.classList.add("col-1");

        col_3_1.appendChild(inputbox);
        col_3_2.appendChild(datebox);
        col_3_3.appendChild(remove_btn);
        var mt_3 = document.createElement("div");
        mt_3.classList.add("row", "justify-content-center", "mt-3");
        mt_3.append(col_3_1, col_3_2, col_3_3);
        row.append(mt_3);
      }
      function uploadfile() {
        var data = new FormData();
        jQuery.each(jQuery("#inputGroupFile04")[0].files, function (i, file) {
          data.append("file", file);
        });
        console.log(data);
        jQuery.ajax({
          url: "http://localhost:63739/api/Upload/Post",
          data: data,
          cache: false,
          contentType: false,
          processData: false,
          method: "POST",
          type: "POST", // For jQuery < 1.9
          success: function (data) {
            console.log(data);
          },
        });
      }
      function getHolidayData() {
        var settings = {
          url: "http://app.sreesubh.in/api/Holiday/getHoliday",
          method: "GET",
          dataType: "json",
        };
        $.ajax(settings)
          .done(function (response) {
            var datas_str = "";
            response.map((item, index) => {
              var holidayItem = `<tr>
                <td>${item.Id}</td>
                <td>${item.holidayName}</td>
                <td>${item.holidayDate}</td>
                <td>
                  <div class="btn-group">
                    <button
                      class="btn btn-warning"
                      type="button"
                      onclick="setdata(this)"
                      data-bs-toggle="modal"
                      data-bs-target="#exampleModal"
                    >
                      <i class="fas fa-edit"></i>
                      Edit
                    </button>
                    <button class="btn btn-danger" type="button" onclick="deleteMe(this)">
                      <i class="fa fa-trash" aria-hidden="true"></i>
                      Delete
                    </button>
                  </div>
                </td>
              </tr>`;
              datas_str += holidayItem;
            });
            $("tbody").html(datas_str);
          })
          .fail((resp) => {
            console.log(resp);
          });
      }
      function deleteMe(data) {
        Swal.fire({
          title: "Are you sure?",
          text: "You won't be able to revert this!",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes, delete it!",
        }).then((result) => {
          if (result.isConfirmed) {
            var x = data.parentElement.parentElement.parentElement;
            var id = x.getElementsByTagName("td")[0].innerText;
            var url = "http://app.sreesubh.in/api/Holiday/deleteHoliday/" + id;
            var settings = {
              url: url,
              method: "GET",
              dataType: "json",
            };
            $.ajax(settings)
              .done(function (response) {
                Swal.fire(
                  "Deleted!",
                  x.getElementsByTagName("td")[1].innerText +
                    " has been deleted.",
                  "success"
                );
                getHolidayData();
              })
              .fail((resp) => {
                console.log(resp);
              });
          }
        });
      }
    </script>
  </body>
</html>
