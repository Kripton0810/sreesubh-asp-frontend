<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <title>Sreesubh</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css"
    />
    <style>
      .title {
        width: 100%;
        display: flex;
        flex-direction: row;
        align-items: center;
      }

      
      @font-face {
        font-family: dolphin;
        src: url(../Dolphin.ttf);
      }
      canvas {
        width: 100% !important;
        height: 400px !important;
      }
    </style>
  </head>

  <body onload="getData()">
  
    <header class="d-flex align-items-center justify-content-between">
      <nav class="navbar navbar-light bg-light d-flex flex-row">
        <div class="container-fluid">
          <div class="title">
            <div
              class="btn"
              type="button"
              data-bs-toggle="offcanvas"
              data-bs-target="#offcanvasExample"
              aria-controls="offcanvasExample"
            >
              <i class="fas fa-bars p-2"></i>
            </div>
            <a
              class="navbar-brand px-3 mx-4"
              href="/"
              style="
                font-family: dolphin;
                font-size: 2rem;
                color: rgb(201, 201, 0);
              "
              >Sreesubh</a
            >
          </div>
        </div>
      </nav>
      <div class="right-cont mx-5">
        <div
          class="btn btn-outline-warning"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasBottom"
          aria-controls="offcanvasBottom"
        >
          <i class="fa fa-sliders" aria-hidden="true"></i>
          Settings
        </div>
      </div>
      <div
        class="offcanvas offcanvas-bottom h-50"
        tabindex="-1"
        id="offcanvasBottom"
        aria-labelledby="offcanvasBottomLabel"
      >
      
    <div class="toast" style="position: fixed; top: 20%; left: 2%;">
      <div class="toast-header">
        <strong class="me-auto">Notification</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
      </div>
      <div class="toast-body">
        <p class="noti-message">Some text inside the toast body</p>
      </div>
    </div>
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="offcanvasBottomLabel">
            <i class="fa-solid fa-gear"></i> Attendance Settings
          </h5>
          <button
            type="button"
            class="btn-close text-reset"
            data-bs-dismiss="offcanvas"
            aria-label="Close"
          ></button>
        </div>
        <div class="offcanvas-body small">
          <div class="d-flex align-items-start">
            <div
              class="nav flex-column nav-pills me-3"
              id="v-pills-tab"
              role="tablist"
              aria-orientation="vertical"
            >
              <button
                class="nav-link active"
                id="v-pills-home-tab"
                data-bs-toggle="pill"
                data-bs-target="#v-pills-home"
                type="button"
                role="tab"
                aria-controls="v-pills-home"
                aria-selected="true"
              >
                Make Login
              </button>
              <button
                class="nav-link"
                id="v-pills-profile-tab"
                data-bs-toggle="pill"
                data-bs-target="#v-pills-profile"
                type="button"
                role="tab"
                aria-controls="v-pills-profile"
                aria-selected="false"
              >
                Make Logout
              </button>
              <button
                class="nav-link"
                id="v-pills-messages-tab"
                data-bs-toggle="pill"
                data-bs-target="#v-pills-messages"
                type="button"
                role="tab"
                aria-controls="v-pills-messages"
                aria-selected="false"
              >
                Report generator
              </button>
              <button
                class="nav-link"
                id="v-pills-settings-tab"
                data-bs-toggle="pill"
                data-bs-target="#v-pills-settings"
                type="button"
                role="tab"
                aria-controls="v-pills-settings"
                aria-selected="false"
              >
                Settings
              </button>
            </div>
            <div class="tab-content w-100" id="v-pills-tabContent">
              <div
                class="tab-pane fade show active container"
                id="v-pills-home"
                role="tabpanel"
                aria-labelledby="v-pills-home-tab"
              >
                <div class="row justify-content-around align-items-center">
                  <div class="col-3 mx-3">
                    <input
                      type="date"
                      id="loginMakeDate"
                      class="form-control"
                      placeholder="Login Date"
                      aria-label="Login Date"
                    />
                  </div>
                  <div class="col-3 mx-3">
                    <input
                      type="time"
                      id="loginMakeTime"
                      class="form-control"
                      placeholder="Login Time"
                      aria-label="Login Time"
                    />
                  </div>
                  <div class="form-check form-switch col-3 mx-3">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="flexSwitchCheckDefault"
                    />
                    <label class="form-check-label" for="flexSwitchCheckDefault"
                      >Present</label
                    >
                  </div>
                  <button
                    type="button"
                    class="btn btn-primary col"
                    onclick="makelogin()"
                  >
                    Update Login
                  </button>
                </div>
              </div>
              <div
                class="tab-pane fade"
                id="v-pills-profile"
                role="tabpanel"
                aria-labelledby="v-pills-profile-tab"
              >
                <div class="row justify-content-around align-items-center">
                  <div class="col-3 mx-3">
                    <input
                      type="date"
                      id="logoutMakeDate"
                      class="form-control"
                      placeholder="Logout Date"
                      aria-label="Logout Date"
                    />
                  </div>
                  <div class="col-3 mx-3">
                    <input
                      type="time"
                      id="logoutMakeTime"
                      class="form-control"
                      placeholder="Logout Time"
                      aria-label="Logout Time"
                    />
                  </div>
                  <button
                    type="button"
                    class="btn btn-primary col"
                    onclick="makelogout()"
                  >
                    Update Logout
                  </button>
                </div>
              </div>
              <div
                class="tab-pane fade"
                id="v-pills-messages"
                role="tabpanel"
                aria-labelledby="v-pills-messages-tab"
              >
                <div class="container">
                  <div class="row mb-2">
                    <input
                        type="text"
                        class="form-control col-6 text-align-center"
                        name="datefilter"
                        id="dateforreport"
                        placeholder="Select Date..."
                        value=""
                      />

                  </div>
                  <div class="row">
                    <div class="col-6">
                      <div class="btn btn-primary w-100" onclick="sendRepAdmin()">
                        <span class="spinner-border spinner-border-sm d-none" id="spinner" role="status" aria-hidden="true"></span>
                        Send Report To Admin</div>
                    </div>
                    <div class="col-6">
                      <div class="btn btn-danger w-100" onclick="sendRepEmp()">
                        <span class="spinner-border spinner-border-sm d-none" id="spinner2" role="status" aria-hidden="true"></span>
                        Send Report To Employees</div>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="tab-pane fade"
                id="v-pills-settings"
                role="tabpanel"
                aria-labelledby="v-pills-settings-tab"
              >
                ...
              </div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <div
      class="offcanvas offcanvas-start"
      tabindex="-1"
      id="offcanvasExample"
      aria-labelledby="offcanvasExampleLabel"
    >
      <div class="offcanvas-header">
        Sreesubh
        <button
          type="button"
          class="btn-close text-reset"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body small">
        <div class="list-group">
          <a
            href="/"
            class="list-group-item list-group-item-action"
            aria-current="true"
          >
            <i class="fas fa-home"></i> Home
          </a>
          <a
            href="../attendance/"
            class="list-group-item list-group-item-action active"
            ><i class="fa fa-user-circle" aria-hidden="true"></i> Attendance</a
          >
          <a href="../Holiday/" class="list-group-item list-group-item-action"
            ><i class="fas fa-cloud-sun"></i> Holiday</a
          >
          <a href="../Leavemanagement/" class="list-group-item list-group-item-action"
            ><i class="fa fa-user-circle" aria-hidden="true"></i> Leave
            request</a
          >
          <a
            href="../Report/"
            class="list-group-item list-group-item-action"
            tabindex="-1"
            aria-disabled="true"
            ><i class="fa fa-sticky-note" aria-hidden="true"></i> Get Attendance
            Report</a
          >
        </div>
      </div>
    </div>
    <main class="d-flex flex-column">
      <div
        class="top-head d-flex flex-row justify-content-around align-items-center mt-2"
      >
        <select
          class="form-select px-3 mx-5 w-50"
          id="employees"
          aria-label="Default select example"
        >
          <option selected>Select Employee</option>
        </select>

        <input
          type="text"
          class="form-control w-25 text-align-center"
          name="datefilter"
          id="startdate"
          placeholder="Select Date..."
          value=""
        />
        <input type="time" name="" class="form-control w-25 mx-2" id="intime" />
        <button
        style="cursor: pointer;"
          class="btn d-flex align-items-center btn-primary mx-5"
          onclick="getAttendance()"
        >
          <i class="fa fa-arrow-circle-right" aria-hidden="true"></i>
          <span class="px-2 mx-2">GO</span>
        </button>
      </div>
      <table
        class="table table-dark table-hover mt-2 mx-auto"
        style="width: 95%"
      >
        <thead>
          <tr>
            <th scope="col">Date</th>
            <th scope="col">Status</th>
            <th scope="col">Login Time</th>
            <th scope="col">Login Address</th>
            <th scope="col">Logout Time</th>
            <th scope="col">Logout Address</th>
          </tr>
        </thead>
        <tbody id="emptable"></tbody>
      </table>
      <div
        class="chart-container"
        style="margin: auto; position: relative; width: 100%"
      >
        <canvas id="myChart"></canvas>
      </div>
    </main>
  </div>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <script type="text/javascript">
      function toastCall(msg) {
        
        var toastElList = [].slice.call(document.querySelectorAll(".toast"));
        var toastList = toastElList.map(function (toastEl) {
          return new bootstrap.Toast(toastEl);
        });
        document.querySelector(".noti-message").innerHTML=msg;
        toastList.forEach((toast) => toast.show());
      }
      function sendRepAdmin() {
        // 
        var startdate = document.getElementById("dateforreport");
        var dates = String(startdate.value);
        var date = dates.split(" to ");
        $("#spinner").removeClass("d-none");
       
        var settings = {
          url: "http://app.sreesubh.in/api/Attendance/makeReport",
          method: "POST",
          data:{
            startDate:date[0],
            endDate:date[1]
          }
        };
        $.ajax(settings).done(function (response) {    
          $("#spinner").addClass("d-none");  
          console.log(response);
          toastCall(response.msg);
        }).fail((error)=>{
          $("#spinner").addClass("d-none");  
          console.log(response);
          toastCall(response.msg);
        });
      }
      function sendRepEmp() {
        // 
        var startdate = document.getElementById("dateforreport");
        var dates = String(startdate.value);
        var date = dates.split(" to ");
        $("#spinner2").removeClass("d-none");
        var settings = {
          url: "http://app.sreesubh.in/api/Attendance/makeReportForEmp",
          method: "POST",
          data:{
            startDate:date[0],
            endDate:date[1]
          }
        };
        
        $.ajax(settings).done(function (response) {    
          $("#spinner2").addClass("d-none");  
          console.log(response);
          toastCall(response.msg);
        }).fail((error)=>{
          $("#spinner2").addClass("d-none");  
          console.log(response);
          toastCall(response.msg);
        });
      }
      
      function makelogout() {
        var empid = document.getElementById("employees").value;
        var loginMakeDate = document.getElementById("logoutMakeDate").value;
        var loginMakeTime = document.getElementById("logoutMakeTime").value;
        var settings = {
          url: "http://app.sreesubh.in/api/Attendance/makeLogout",
          method: "POST",
          dataType: "json",
          data: {
            EmployeeId: empid,
            logoutDate: loginMakeDate,
            logoutTime: loginMakeTime,
          },
        };
        console.log(settings);
        $.ajax(settings).done(function (response) {      
          console.log(response);
          getAttendance();    
          toastCall(response.msg);
        });
      }
      function makelogin() {
        var empname = $("#employees option:selected").text();
        var empid = document.getElementById("employees").value;
        var loginMakeDate = document.getElementById("loginMakeDate").value;
        var loginMakeTime = document.getElementById("loginMakeTime").value;
        var flexSwitchCheckDefault = document.getElementById(
          "flexSwitchCheckDefault"
        ).checked;
        var status = "A";
        if (flexSwitchCheckDefault) {
          status = "P";
        }
        var settings = {
          url: "http://app.sreesubh.in/api/Attendance/makeLogin",
          method: "POST",
          dataType: "json",
          data: {
            EmployeeId: empid,
            employeeName: empname,
            status: status,
            loginDate: loginMakeDate,
            loginTime: loginMakeTime,
          },
        };
        $.ajax(settings).done(function (response) {
          console.log(response);
          toastCall(response.msg);
          getAttendance();
        });
      }
      $(function () {
        $('input[name="datefilter"]').daterangepicker({
          autoUpdateInput: false,
          locale: {
            cancelLabel: "Clear",
          },
        });

        $('input[name="datefilter"]').on(
          "apply.daterangepicker",
          function (ev, picker) {
            $(this).val(
              picker.startDate.format("YYYY-MM-DD") +
                " to " +
                picker.endDate.format("YYYY-MM-DD")
            );
          }
        );

        $('input[name="datefilter"]').on(
          "cancel.daterangepicker",
          function (ev, picker) {
            $(this).val("");
          }
        );
      });
      function getAttendance() {
        var emp = document.getElementById("employees");
        var startdate = document.getElementById("startdate");
        var id = emp.value;
        var dates = String(startdate.value);
        var date = dates.split(" to ");
        console.log("Hello");
        var data =  {
            EmployeeId: id,
            startDate: date[0],
            endDate: date[1],
          }
        var settings = {
          url: "http://app.sreesubh.in/api/Attendance/specificAttandanceweb",
          method: "POST",
          dataType: "json",
          data: data,
          
        };
        var table = "";
        var dateList = [];
        var workList = [];
        console.log(settings);
        $.ajax(settings).done(function (response) {
          response.map((item, pos) => {
            table += `
            <tr>
              <td>${item.loginDate}</td>
              <td>${item.status}</td>
              <td>${item.loginTime}</td>
              <td>${String(item.loginAddress).substring(0,50)+"..."}</td>
              <td>${item.logoutTime}</td>
              <td>${String(item.logoutAddress).substring(0,50)+"..."}</td>
            </tr>
            `;
            dateList.push(item.loginDate);
            workList.push(item.workTime);
          });
          makeChart(dateList, workList);
          $("#emptable").html(table);
        }).fail((resp)=>{
          console.log(resp);
        });
      }
      function getData() {
        var emp = document.getElementById("employees");
        $.ajax({
          url: "http://app.sreesubh.in/api/Employee/getEmployee",
          type: "get",
          async: false,
          success: function (data) {
            var empstr = "<option selected>Select Employee</option>";
            data.map((item, index) => {
              empstr += `<option value="${item.EmployeeId}">${item.EmployeeName}</option>`;
            });
            emp.innerHTML = empstr;
          },
        });
      }

      var myChart;
      function makeChart(labels, datas) {
        console.log(labels);
        console.log(datas);
        console.log("datas");
        const ctx = document.getElementById("myChart").getContext("2d");
        var d = {
          labels: labels,
          datasets: [
            {
              type: "line",
              label: "Working hours",
              fill: true,
              data: datas,
              backgroundColor: [
                "rgba(255, 99, 132, 0.2)",
                "rgba(54, 162, 235, 0.2)",
                "rgba(255, 206, 86, 0.2)",
                "rgba(75, 192, 192, 0.2)",
                "rgba(153, 102, 255, 0.2)",
                "rgba(255, 159, 64, 0.2)",
              ],
              borderColor: [
                "rgba(255, 99, 132, 1)",
                "rgba(54, 162, 235, 1)",
                "rgba(255, 206, 86, 1)",
                "rgba(75, 192, 192, 1)",
                "rgba(153, 102, 255, 1)",
                "rgba(255, 159, 64, 1)",
              ],
              borderWidth: 1,
            },
          ],

          options: {
            responsive: true,
            maintainAspectRatio: false,
          },
        };
        if (myChart) {
          myChart.destroy();
        }
        myChart = new Chart(ctx, {
          data: d,
          options: {
            scales: {
              y: {
                min: 0,
              },
            },
          },
        });
      }
    </script>
  </body>
</html>
